package auth_test

import (
	"testing"
	"time"

	"github.com/stretchr/testify/require"

	"github.com/SKF/go-rest-utility/client/auth"
)

func TestRawToken_Expires_Happy(t *testing.T) {
	t.Parallel()

	expiredRealToken := auth.RawToken("eyJraWQiOiJ3TktkUUtMQURMdmVoRzR5V2h0RjRHZSsyUW9Rdm1DXC9vRzdFWkU0cVI2ND0iLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiJiMDQ4YzAwMy1jMmJjLTRmYjAtYmVlYi00OTlmYTA2YWE5NmUiLCJldmVudF9pZCI6Ijg3ZThiMzgwLTgwODMtNDY3Yy04OWU3LTUyNzliODExMTYyNiIsInRva2VuX3VzZSI6ImFjY2VzcyIsInNjb3BlIjoiYXdzLmNvZ25pdG8uc2lnbmluLnVzZXIuYWRtaW4iLCJhdXRoX3RpbWUiOjE2MzExNjc1NTQsImlzcyI6Imh0dHBzOlwvXC9jb2duaXRvLWlkcC5ldS13ZXN0LTEuYW1hem9uYXdzLmNvbVwvZXUtd2VzdC0xX0RnN3BURGpXYyIsImV4cCI6MTYzMTY4NzAxNywiaWF0IjoxNjMxNjgzNDE3LCJqdGkiOiIzZTRmNjQ2ZC1iOGRhLTQ3OTQtYjMwNy0yYTE1MDk5MWI1ZmYiLCJjbGllbnRfaWQiOiIxOThhaXEwdXBwajBtbzZjMjh1bHZ1aWYxYiIsInVzZXJuYW1lIjoiY3VhX2VubGlnaHRAc2tmLmNvbSJ9.NA-Z_fjYI3-YnerG23He6j3ef-mhIZgQaQty46Ja_iZrGDMomW4q97uDTEjD_XY_AdILofS5_N_fCHJwhNauNgY8TGE5rmj1IE4PXYhup8PR3Mn2us7IyFlPyk537nOEqAyBIdcu42Bb_mNyG5Qt_4CuMQJnXKTOiGcEg1RXQT44OA13csfqG5lCQtje08daa91MjqOF3gg-laG1l7ETotpqhaVehjjPCeH2ii4YH4sCh9Az3sUDrmCT83UIqLxMHm22yDnwSF-IuZAOGRV_YC_KZn7NcQr9i_ah7NSiDi_GPL1jFRbQv1sytn8bflZJQ_TuyvSxe28jLkSHDVqxZQ")

	exp, err := expiredRealToken.ParseExpires()

	require.NoError(t, err)
	require.Equal(t, time.Unix(1631687017, 0), exp)
}
func TestRawToken_Expires_InvalidJWT(t *testing.T) {
	t.Parallel()

	token := auth.RawToken("FOO")

	_, err := token.ParseExpires()
	require.Error(t, err)
	require.ErrorIs(t, err, auth.ErrInvalidToken)
}

func TestRawToken_Expires_RefreshToken(t *testing.T) {
	t.Parallel()

	refreshToken := auth.RawToken("eyJjdHkiOiJKV1QiLCJlbmMiOiJBMjU2R0NNIiwiYWxnIjoiUlNBLU9BRVAifQ.RNBPbs-yZrDUr3-bFvIMTABkeN4v1lj1KuKIEwa-Yo_P8t1I_VOC2DkOxe2bkyHxCtddd8XkOes8-s_iIJNZoee95Ek5kAaTQkR0hIL5ShmE8IufifUfIUXV2fMb8Gz_sZXnKhD-uTnbv8v0nFsSzImRV4srPaungc4P_m2IRgzEGdV713Yz72HFHs-s5RS1flLSlzP4JzRsctzkHgLIyqaU_90kGDc7wgodRZ6CSZAaPdZm1-O7OaISPntj_dyTCWovjvxz8BxUkx0EXQw0vTMRPSl20zZe-Mj9Wc1s6AnULCVJYTnm4_5ijZft1P7YaH74Nip5832vpLGj-qTiWg.O3fOyuIOkkza2K2R.BWftjFKsEc_i7XYScsE6FkKDS41kNLobBWtuSg9TvdtK3WqXCWjOOJjX_E5Y0UM-GFlgRrjY_mJUSI3_sTR87CfHXuEnV0fP9EHNQa6RMi7IgVTLgit6RZw5s9c0XmOBq3gr5j7DHX8JgI5jWv7-cu0FysbnHxZEIM95PCQmVvKez4mXB4x_BSwssbR4HodD3D6d8oBee1gWSJoQrszYkJtTQ6RLsIKdKgYp3qIXxEDRpGp6cgP1JiROcM4NQ7rWIPU8ZJkbVYdxQXM8JWjksWIdhaFESjil3TwjbGEIPJWiZvv5Emaj9FsRKZlyrBcPkrhvaXD0cpGkJQEuGQPlFnZArYmCvpSpRWkkSsS9f0Oh3CdLuM2CYedEM8CGS_s_685Bj3hEgo2ZzKmhO6PuxKvRyQFxvC0gM7UOPVby6GTeGQzkRPJExct8wCFZQG-mx5qxqJp4qTGLqUGtnF3GTZDXxNYa3MTRqNedRBCY4aJ8bPTxTDE1D6mbwYf4VAXw8vwy3RK4ad9d_aBbVClGGKUq66OaMefERC2-N4-0VckhllL2bNstcTJjKlOItQrFyZBgnevifXovdsM8SUO4MnHz-eU0MS-37LBMJP-u4SWcN8q_c8UXhXgwoVxdiRwNo_1Tp1uhyUcW-lq43a0CmBu9N9gNUA9yfTwEKKUENjkeWJogVKT1wpw80NWwrIbnGeXx5yfYRSOFLIRPbONpuUv81OF_kLL1fTlFVaJfpFCvxANbDpS_hWE0IHi3FdjEL57CIJQJaEoo-OXu04rllIoBcctDfFxmgOZrZw84BQLJJMw12H--3QFcv75OlcHE6csjimISnyzLHbFBDHkcL7QqE3UC8D3MGdsgcD64kXar3JqYfBe7yQfzGBXOJnYTD4cwKDa0LHrFLAgqRh_0_1TexwxErC3lxaDvEXtYcDDWLB0TZcCCCl4tJlWbESS0trxYkUkE5RgaXtxlMic0k2ZRF28908iIAkwpf8vgYo1_aKlbeNOubvZfG07GgXnP1wMtxqCijFSJnosw89TB2N0hHH-7FWQ0iiY1O90baUIOKxwW-fLvWA8p2x4F5Jtj-DJz_wLLLdMPXRBSiTwitNTd0a6vO2CaEgHYMsw61E78TilmaprO6q4KYLqk0uLarpPthOlWAqvn7c-fsDmkGVahrNtTds5Pl0LnLwcl0GXwLWXy6lhU_CGRE7lfGWzHBIyNowdNvmCRHGRqVIzZ15A_ai43E7ILBgaOSTg2-5b60h7TABmRPOQ2zNJq_eMDcS78smnuB90QQyKPad2xV_yyWIY_5X05.ZJk24JEIzkvvHcabX9QuYw")

	_, err := refreshToken.ParseExpires()
	require.Error(t, err)
}
